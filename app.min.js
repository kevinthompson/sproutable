var bounds,categories="restaurants,active,arcades,galleries,gardens,movietheaters,festivals,museums,theater,sportsteams,stadiumsarenas,education,campgrounds,tours,skiresorts,poolhalls,farmersmarket",center,current,current_location="",current_term='"Good+For+Kids"',current_sort=0,lat="33.195869",lng="-117.379483",limit=0,map,markers=[],mode=0,offset=0,pg=1,pages=1,results=[],sm="http://maps.googleapis.com/maps/api/staticmap?",u="undefined",updateTimer;if(!$.browser.msie){$(".t").addClass("nie")}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){lat=a.coords.latitude;lng=a.coords.longitude;center=new google.maps.LatLng(lat,lng);if(typeof(map)!=u&&map!=null){map.setCenter(center)}var d=new google.maps.Geocoder();d.geocode({latLng:center},function(e,b){if(b==google.maps.GeocoderStatus.OK){var j="",h="",k=e[0].address_components,f={street_number:"",route:" ",locality:", ",administrative_area_level_1:", ",postal_code:" "},g={locality:"",administrative_area_level_1:", "};for(i in k){if(k[i].types[0] in f){h+=f[k[i].types[0]]+k[i].long_name}if(k[i].types[0] in g){j+=g[k[i].types[0]]+k[i].short_name}}$("#l").attr("placeholder",j);current_location=h}});var c=[];yelp("search",{ll:lat+","+lng,term:current_term},function(e){if(e.businesses.length>0){results=e.businesses;var b="";$.each(results,function(g,f){var h=f.categories[f.categories.length-1][0];c.push(h);if(b.length+h.length<=30&&!(h in c)){b+=(b!=""?", ":"")+h}});$("#t").attr("placeholder",b+", etc.")}})},function(a){},{timeout:10000})}$("form").submit(function(f){f.preventDefault();$(".s").focus();var a=$("#l").val(),c=$("#t").val()+($("#t").val()!=""?" ":"")+'"Good For Kids"',b=$("#sort").val();if(a!=current_location||c!=""&&c!=current_term||b!=current_sort){var d={term:c.replace(/ /g,"+"),sort:b};if(lat!=""&&lng!=""){d[a!=""?"cll":"ll"]=lat+","+lng}if(a!=""){d.location=a.replace(/ /g,"+")}current_location=a!=""?a:current_location;current_term=c!=""?c:current_term;current_sort=b;yelp("search",d,function(e){results=e.businesses;pages=Math.ceil(results.length/limit);showPage(1)})}});function showPage(c,b){pg=c>pages?pages:c;var d=100,e=(pg-1)*limit,a=[];if(typeof(b)==u){b=400}$("body > .d").animate({opacity:0},200,function(){$(this).remove()});if(mode==1){$("#total").text(pages);$("#page").text(pg);if(pg==1){$("#prev").hide()}else{$("#prev").unbind("click").click(function(f){f.preventDefault();showPage(pg-1)}).show()}if(pg==pages){$("#next").hide()}else{$("#next").unbind("click").click(function(f){f.preventDefault();showPage(pg+1)}).show()}for(i in markers){markers[i].setMap(null)}markers=[]}if($("#r").length==0){$('<section id="r" />').insertAfter("#s")}$("#r .g").animate({opacity:0},b);$("#r").animate({height:0},b,function(){if(results.length>0){$("#r").html("");for(i=e;i<e+limit&&i<results.length;i++){(function(){var s=results[i],t="",p="",k=s.categories,j=s.location,n=j.coordinate.latitude,o=j.coordinate.longitude;for(x=0;x<k.length;x++){p+=(p!=""?", ":"")+k[x][0]}t+=typeof(j.address[0])!=u?j.address[0]:"";t+=(typeof(j.address[1])!=u?(t!=""?", ":"")+j.address[1]:"");t+=(typeof(j.city)!=u?(t!=""?"<br /> ":"")+j.city:"");t+=(typeof(j.state_code)!=u?(t!=""?", ":"")+j.state_code:"");t+=(typeof(j.postal_code)!=u?(t!=""?" ":"")+j.postal_code:"");var m="http://maps.google.com/maps?daddr="+s.name+", "+t.replace(/<br \/>/g,", ")+(current_location!=""?"&saddr="+current_location:"");var h=$('<article class="g" />'),y=$('<header class="h clear" />');y.append('<div class="img rs">'+(typeof(s.image_url)=="string"?'<img class="rs" src="'+s.image_url+'" />':"")+"</div>");y.append("<h1>"+s.name+"</h1>");if(typeof(s.distance)!=u){var f=(Math.round((s.distance*10)/1609.344)/10),v="mile";if(f==0){f=Math.round(s.distance);v="meter"}y.append('<div class="distance rs">'+f+" "+v+(f!=1?"s":"")+"</div>")}y.append('<div class="rating"><img class="rs" src="'+s.rating_img_url+'" /><span class="rs">'+s.review_count+"</span></div>");var g=$('<div class="d r clear" />'),w=$('<div class="inner" />').appendTo(g);w.append('<h1 class="rt">'+s.name+"</h1>");var r=$('<div class="meta" />').appendTo(w);r.append('<div class="address"><h2>Address - <a href="'+m+'" target="_blank">Get Directions</a></h2><span>'+t+"</span></div>");if(typeof(s.display_phone)!=u){r.append('<div class="phone"><h2>Phone - <a class="phone" href="tel:+1'+s.phone+'" target="_self">Call</a></h2><span>'+s.display_phone+"</span></div>")}r.append('<div class="categories"><h2>Categories</h2><span>'+p+"</span></div>");w.append('<div class="buttons rb"><a class="b r y" href="'+s.url+'" data-mobile="'+s.mobile_url+'" target="_blank">Read Reviews on Yelp</a></div>');h.append(y,g);$("#r").append(h);if(mode==1){var q=new google.maps.LatLng(n,o);a.push(q);setTimeout(function(){var l=new google.maps.Marker({position:q,map:map,animation:google.maps.Animation.DROP});google.maps.event.addListener(l,"click",function(){showLocation({el:h,pos:q})});y.click(function(z){z.preventDefault();if(h.hasClass("active")){h.removeClass("active")}else{showLocation({el:h,pos:q})}});markers.push(l)},d);d+=Math.random()*100}else{y.click(function(l){l.preventDefault();if(h.hasClass("active")){h.removeClass("active")}else{if(w.find(".mp").length==0){w.prepend('<a class="mp" target="_blank" href="'+m+'"><img class="rs" src="'+sm+"center="+n+","+o+"&zoom=16&size=380x100&maptype=roadmap&markers="+n+","+o+'&sensor=false" /></a>')}showLocation({el:h})}})}})()}if(mode==1&&pages>1){$("#n").show()}else{$("#n").hide()}$("#r .g").animate({opacity:1},b);$("#r").animate({height:($("#r .g").length<limit?$("#r .g").length:limit)*72},b,function(){if(mode==0){$("#r").css("height","auto");$("html,body").animate({scrollTop:$("#r .g:first").offset().top})}});if(mode==1&&typeof(map)!=u&&map!=null&&results.length>0){bounds=new google.maps.LatLngBounds();for(i in a){bounds.extend(a[i])}map.setZoom(14);map.fitBounds(bounds)}}else{$("#r").remove()}})}$("a").not('[href^="tel"],[href^="#"],[href^="/"],[href*="'+window.location.host+'"]').attr("target","_blank");$("a").live("click",function(a){if(mode==0&&$(this).attr("data-mobile")!=""){$(this).attr("data-desktop",$(this).attr("href"));$(this).attr("href",$(this).attr("data-mobile"))}else{if($(this).attr("data-desktop")!=""){$(this).attr("href",$(this).attr("data-desktop"))}}});function centerMap(c,g){if(typeof(g)==u){var g=true}var d=Math.pow(2,map.getZoom()),e=map.getProjection().fromLatLngToPoint(current),b=$("#c").offset().left+$("#c").outerWidth(),a=($(window).width()-b)/2,h=$(window).height()/6;e.x=((e.x*d)-(a+b-($(window).width()/2)))/d;e.y=((e.y*d)-h)/d;var f=map.getProjection().fromPointToLatLng(e);map.panTo(f);if(typeof(c)!=u){google.maps.event.addListenerOnce(map,"idle",function(){c(a+b)})}}function showLocation(b){$(".g").not(b.el).removeClass("active");b.el.addClass("active");if(mode==0){$("html,body").animate({scrollTop:b.el.offset().top-1})}else{$("body > .d").animate({opacity:0},200,function(){$(this).remove()});current=b.pos;var a=b.el.find(".d").clone();a.css({opacity:0}).appendTo("body");if(typeof(b.pan)==u){b.pan=true}centerMap(function(c){$("body > .d").css({left:c-$("body > .d").outerWidth()/2,bottom:"34%"}).animate({opacity:1,bottom:"38%"})},b.pan)}}function update(){mode=$(window).width()>=769?1:0;$("body > .d").animate({bottom:"34%",opacity:0},200,function(){$(this).remove()});if(mode==0){a=999;pages=1;$("#n").hide();if($("#m > img").length<1){$("#m").html('<img src="'+sm+"center="+lat+","+lng+'&zoom=14&size=768x768&maptype=roadmap&sensor=false" />')}map=null}else{if(typeof(map)==u||map==null){center=new google.maps.LatLng(lat,lng);map=new google.maps.Map(document.getElementById("m"),{zoom:12,center:center,draggable:false,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:false,mapTypeControl:false,panControl:false,zoomControl:false,streetViewControl:false})}if($(".g").length>0){$(".g").removeClass("active");map.fitBounds(bounds)}var a=Math.floor(($(window).height()-parseInt($("#c").css("margin-top"))-parseInt($("#c").css("margin-bottom"))-$("#s").outerHeight()-$("#h").outerHeight()-$("#n").outerHeight()-$("#f").outerHeight()-16)/72);pages=Math.ceil(results.length/a)}if(a<=0){a=1}if(a!=limit){limit=a;if($(".g").length>0){showPage(pg,0)}}}$(window).resize(update);update();